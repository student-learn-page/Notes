<!DOCTYPE html>
<html>
<head>
  <title>Student-learnüéì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.5/dist/umd/supabase.js"></script>
  <style>
    :root {
      --bg: #111;
      --text: #e0e0e0;
      --accent: #00ff99;
      --card-bg: #000;
      --input-bg: #000;
      --note-text: #fff;
      --note-bg: #222;
      --border: #444;
    }

    .light-theme {
      --bg: #fff;
      --text: #000;
      --accent: #007bff;
      --card-bg: #f5f5f5;
      --input-bg: #f0f0f0;
      --note-text: #000;
      --note-bg: #e0e0e0;
      --border: #ccc;
    }

    body {
      font-family: 'Courier New', monospace;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding-bottom: 80px;
      transition: all 0.3s ease;
    }

    .tab-content, .subpage {
      display: none;
      padding: 20px;
    }

    .active {
      display: block;
    }

    h2, h3 {
      text-align: center;
      color: var(--accent);
    }

    button, .format-btn {
      padding: 10px 20px;
      font-size: 16px;
      background: #000;
      color: #fff;
      border: 1px solid #fff;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px auto;
      display: block;
      font-weight: bold;
    }

    .format-btn {
      width: 80%;
      max-width: 300px;
    }

    button:hover, .format-btn:hover {
      background: #fff;
      color: #000;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin: 15px auto;
      max-width: 600px;
    }

    img, video {
      width: 100%;
      max-height: 320px;
      border-radius: 6px;
    }

    pre {
      background: var(--note-bg);
      color: var(--note-text);
      padding: 10px;
      border-radius: 6px;
      white-space: pre-wrap;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      font-family: inherit;
      margin-bottom: 10px;
      border: 1px solid var(--accent);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--accent);
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #000;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid var(--border);
      padding: 10px 0;
    }

    .bottom-nav button {
      flex: 1;
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
    }

    .bottom-nav button:hover {
      background: #fff;
      color: #000;
    }

    .status {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div style="text-align: right; padding: 10px;">
  <button onclick="toggleTheme()">üåó Toggle Theme</button>
</div>

<!-- Tabs -->
<div id="homeTab" class="tab-content active">
  <h2>üè† Home ‚Äì Latest Uploads</h2>
  <div id="homeList"></div>
</div>

<div id="sequenceTab" class="tab-content">
  <h2>üìÇ Sequence View</h2>
  <button class="format-btn" onclick="openPage('notesPage')">üìÑ Notes</button>
  <button class="format-btn" onclick="openPage('pdfsPage')">üìë PDFs</button>
  <button class="format-btn" onclick="openPage('imagesPage')">üñºÔ∏è Images</button>
  <button class="format-btn" onclick="openPage('videosPage')">üìπ Videos</button>
</div>

<div id="uploadTab" class="tab-content">
  <h2>üì§ Upload Files</h2>
  <input id="title" type="text" placeholder="Enter title" />
  <select id="format">
    <option value="note">Note</option>
    <option value="image">Image</option>
    <option value="video">Video</option>
    <option value="pdf">PDF</option>
  </select>
  <textarea id="noteText" placeholder="(if Note) Type your note..."></textarea>
  <input type="file" id="filePicker" />
  <button onclick="uploadContent()">Upload</button>
  <p class="status" id="status"></p>
</div>

<!-- Sequence Subpages -->
<div id="notesPage" class="subpage">
  <button onclick="goBack()">‚¨Ö Back</button>
  <h3>üìÑ All Notes</h3>
  <div id="notesList"></div>
</div>

<div id="pdfsPage" class="subpage">
  <button onclick="goBack()">‚¨Ö Back</button>
  <h3>üìë All PDFs</h3>
  <div id="pdfList"></div>
</div>

<div id="imagesPage" class="subpage">
  <button onclick="goBack()">‚¨Ö Back</button>
  <h3>üñºÔ∏è All Images</h3>
  <div id="imageList"></div>
</div>

<div id="videosPage" class="subpage">
  <button onclick="goBack()">‚¨Ö Back</button>
  <h3>üìπ All Videos</h3>
  <div id="videoList"></div>
</div>

<!-- Navigation -->
<div class="bottom-nav">
  <button onclick="switchTab('homeTab')">üè† Home</button>
  <button onclick="switchTab('sequenceTab')">üìÇ Sequence</button>
  <button onclick="askPassword()">üì§ Upload</button>
</div>

<script>
const BUCKET = "recordings";
const client = supabase.createClient(
  'https://kelbfujbyjtdeopkhhxm.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlbGJmdWpieWp0ZGVvcGtoaHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMzc5OTgsImV4cCI6MjA2MjgxMzk5OH0.iB97MRNwVCrhtDQaHrh7Q7ra1x4nVNGhih-Tm_pq31k'
);

const uploadPassword = "Kotli7890";

function askPassword() {
  const pass = prompt("üîí Enter password to access Upload:");
  if (pass === uploadPassword) {
    switchTab("uploadTab");
  } else {
    alert("‚ùå Wrong password!");
  }
}

function toggleTheme() {
  document.body.classList.toggle("light-theme");
}

let allFiles = [];

function switchTab(tabId) {
  hideAll();
  document.getElementById(tabId).classList.add("active");
}

function openPage(pageId) {
  hideAll();
  document.getElementById(pageId).classList.add("active");
  if (pageId === "notesPage") renderFiles("note", "notesList");
  if (pageId === "pdfsPage") renderFiles("pdf", "pdfList");
  if (pageId === "imagesPage") renderFiles("image", "imageList");
  if (pageId === "videosPage") renderFiles("video", "videoList");
}

function goBack() {
  hideAll();
  document.getElementById("sequenceTab").classList.add("active");
}

function hideAll() {
  document.querySelectorAll(".tab-content, .subpage").forEach(el => el.classList.remove("active"));
}

async function uploadContent() {
  const title = document.getElementById("title").value.trim();
  const format = document.getElementById("format").value;
  const noteText = document.getElementById("noteText").value.trim();
  const file = document.getElementById("filePicker").files[0];
  const fileName = `${Date.now()}__${format}__${title || "untitled"}`;

  let uploadFile;
  if (format === "note") {
    if (!noteText) return alert("Note is empty.");
    uploadFile = new File([noteText], fileName + ".txt", { type: "text/plain" });
  } else {
    if (!file) return alert("Choose a file.");
    uploadFile = new File([file], fileName + "." + file.name.split(".").pop(), { type: file.type });
  }

  const { error } = await client.storage.from(BUCKET).upload(fileName, uploadFile);
  document.getElementById("status").innerText = error ? "‚ùå " + error.message : "‚úÖ Uploaded!";
  if (!error) {
    document.getElementById("noteText").value = "";
    document.getElementById("title").value = "";
    document.getElementById("filePicker").value = "";
    loadAll();
  }
}

async function loadAll() {
  const { data } = await client.storage.from(BUCKET).list('', { sortBy: { column: 'name', order: 'desc' } });
  allFiles = data;
  const home = document.getElementById("homeList");
  home.innerHTML = "";

  for (let file of data || []) {
    const { data: signed } = await client.storage.from(BUCKET).createSignedUrl(file.name, 3600);
    if (!signed?.signedUrl) continue;
    const card = await createCard(file.name, signed.signedUrl);
    home.appendChild(card.cloneNode(true));
  }
}

async function renderFiles(format, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  for (let file of allFiles || []) {
    if (!file.name.includes(`__${format}__`)) continue;
    const { data: signed } = await client.storage.from(BUCKET).createSignedUrl(file.name, 3600);
    if (!signed?.signedUrl) continue;
    const card = await createCard(file.name, signed.signedUrl);
    container.appendChild(card);
  }
}

async function createCard(fileName, url) {
  const format = fileName.split("__")[1];
  const card = document.createElement("div");
  card.className = "card";

  if (format === "note") {
    const res = await fetch(url);
    const text = await res.text();
    const pre = document.createElement("pre");
    pre.textContent = text;
    card.appendChild(pre);
  } else if (format === "image") {
    const img = document.createElement("img");
    img.src = url;
    card.appendChild(img);
  } else if (format === "video") {
    const vid = document.createElement("video");
    vid.src = url;
    vid.controls = true;
    card.appendChild(vid);
  } else if (format === "pdf") {
    const link = document.createElement("a");
    link.href = url;
    link.innerText = "üìÑ View PDF";
    link.target = "_blank";
    card.appendChild(link);
  }

  return card;
}

window.onload = loadAll;
</script>
</body>
</html>
